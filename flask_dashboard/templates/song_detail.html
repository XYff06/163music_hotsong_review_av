<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{{ song.title }}</title>

    <!-- å¼•å…¥ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

    <style>
        /* ================= å…¨å±€æ ·å¼ ================= */
        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            background: linear-gradient(180deg, #eef2f7 0%, #f9fafc 100%);
            margin: 0;
            padding: 0;
            color: #333;
        }

        h2 {
            text-align: center;
            margin: 40px 0 10px;
            color: #1E46D4;
            font-size: 28px;
            letter-spacing: 1px;
        }

        p.nav-links {
            text-align: center;
            margin-bottom: 30px;
        }

        p.nav-links a {
            margin: 0 12px;
            text-decoration: none;
            color: #34495e;
            font-weight: 500;
            transition: color 0.3s;
        }

        p.nav-links a:hover {
            color: #1E46D4;
        }

        h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        /* ================= å¡ç‰‡é€šç”¨æ ·å¼ ================= */
        .card {
            max-width: 1200px;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 25px 30px;
            margin: 0 auto 60px auto;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
        }

        /* ================= å›¾è¡¨å®¹å™¨ ================= */
        #chart1, #chart2 {
            width: 100%;
            height: 480px;
        }

        /* ================= è¯äº‘åŒºåŸŸ ================= */
        .wordcloud-section {
            text-align: center;
        }

        .wordcloud-section img {
            max-width: 92%;
            height: auto;
            border-radius: 12px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .wordcloud-section img:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

    </style>
</head>

<body>

<!-- ================= æ ‡é¢˜ä¸å¯¼èˆª ================= -->
<h2>{{ song.title }}</h2>
<p class="nav-links">
    <a href="/">â¬… è¿”å›é¦–é¡µ</a> |
    <a href="{{ song.href }}" target="_blank">ğŸµ è®¿é—®ç½‘æ˜“äº‘éŸ³ä¹</a>
</p>

<!-- ================= è¯„è®ºæ›²çº¿ ================= -->
<div class="card">
    <h3>ğŸ“ˆ è¯„è®ºç´¯è®¡å˜åŒ–è¶‹åŠ¿</h3>
    <div id="chart1"></div>
</div>

<!-- ================= è¯äº‘å±•ç¤º ================= -->
<div class="card wordcloud-section">
    <h3>â˜ çƒ­é—¨è¯„è®ºè¯äº‘</h3>
    {% if wordcloud_path %}
        <!-- Flaskæ¨¡æ¿å˜é‡:åŠ¨æ€åŠ è½½è¯äº‘å›¾ç‰‡ -->
        <img src="{{ url_for('static', filename=wordcloud_path) }}" alt="è¯äº‘å›¾">
    {% else %}
        <p>æš‚æ— è¯äº‘æ•°æ®</p>
    {% endif %}
</div>

<!-- ================= TF-IDFå…³é”®è¯ ================= -->
<div class="card">
    <h3>ğŸ”¥ çƒ­é—¨çŸ­è¯­(TF-IDFæƒé‡)</h3>
    <div id="chart2"></div>
</div>

<!-- ================= EChartsé…ç½®è„šæœ¬ ================= -->
<script>
    // Flaskä¼ å…¥çš„æ•°æ®
    const data = {{ data | tojson }};
    const tfidf = {{ tfidf | tojson }};

    /* ========== è¯„è®ºç´¯è®¡æŠ˜çº¿å›¾ ========== */
    const chart1 = echarts.init(document.getElementById('chart1'));
    chart1.setOption({
        backgroundColor: '#fff',
        tooltip: {trigger: 'axis'},
        grid: {left: '8%', right: '8%', bottom: '10%', top: '10%'},
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: data.map(d => d.date),
            axisLabel: {color: '#555', rotate: 0}
        },
        yAxis: {
            type: 'value',
            name: 'ç´¯è®¡è¯„è®ºæ•°',
            nameTextStyle: {color: '#666'},
            axisLabel: {color: '#555'},
            splitLine: {lineStyle: {color: '#eee'}}
        },
        series: [{
            name: 'è¯„è®ºæ€»æ•°',
            type: 'line',
            smooth: true,
            data: data.map(d => d.cumulative_count),
            lineStyle: {width: 3, color: '#1E46D4'},
            itemStyle: {color: '#1E46D4'},
            areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: 'rgba(30, 70, 212, 0.25)'},
                    {offset: 1, color: 'rgba(30, 70, 212, 0.05)'}
                ])
            }
        }]
    });

    /* ========== TF-IDFæ¡å½¢å›¾ ========== */
    const chart2 = echarts.init(document.getElementById('chart2'));
    chart2.setOption({
        backgroundColor: '#fff',
        tooltip: {trigger: 'axis', axisPointer: {type: 'shadow'}},
        grid: {left: '18%', right: '18%', bottom: '10%', top: '10%'},
        xAxis: {
            type: 'value',
            name: 'TF-IDFæƒé‡',
            nameTextStyle: {color: '#666'},
            axisLabel: {color: '#555'},
            splitLine: {lineStyle: {color: '#eee'}}
        },
        yAxis: {
            type: 'category',
            data: tfidf.map(t => t.word).reverse(),
            axisLabel: {color: '#333', fontWeight: 500}
        },
        series: [{
            name: 'å…³é”®è¯æƒé‡',
            type: 'bar',
            data: tfidf.map(t => t.score).reverse(),
            barWidth: 16,
            itemStyle: {
                color: new echarts.graphic.LinearGradient(1, 0, 0, 0, [
                    {offset: 0, color: '#4A6CF7'},
                    {offset: 1, color: '#8BA1FF'}
                ]),
                borderRadius: [6, 6, 6, 6]
            },
            label: {
                show: true,
                position: 'right',
                formatter: '{c}',
                color: '#444',
                fontWeight: '500'
            }
        }]
    });

    // è‡ªé€‚åº”çª—å£å°ºå¯¸
    window.addEventListener('resize', () => {
        chart1.resize();
        chart2.resize();
    });
</script>

</body>
</html>
